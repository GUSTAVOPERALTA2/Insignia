:root{
  --bg: #0f1220;
  --card: #151a2f;
  --card-2: #12162a;
  --text: #e7ecff;
  --muted: #9aa4c7;
  --border: #263156;
  --accent: #6ea8fe;
  --accent-2: #7c4dff;

  --ok: #20c997;      /* verde */
  --warn: #f59f00;    /* amarillo */
  --danger: #ef4444;  /* rojo  */
  --info: #14b8a6;    /* turquesa */

  --it: #60a5fa;
  --man: #f59e0b;
  --ama: #a78bfa;
  --rs:  #14b8a6;
  --seg: #94a3b8;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
body{
  margin:0;
  background:
    radial-gradient(1200px 700px at 80% -100px, rgba(124,77,255,0.15), transparent 60%),
    radial-gradient(800px 600px at -200px 120%, rgba(110,168,254,0.12), transparent 60%),
    var(--bg);
  color: var(--text);
  font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
}

/* Layout */
.wrap{
  max-width: 1380px;
  margin: 0 auto;
  padding: 20px 24px;
}

/* Topbar */
.topbar{
  position: sticky; top:0; z-index: 10;
  background: rgba(15,18,32,.85);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--border);
}
.topbar .wrap{
  display:flex; align-items:center; gap:16px; justify-content:space-between;
}
h1{ font-size: 20px; margin: 8px 0; letter-spacing: .4px; }

/* Filters */
.filters{ display: grid; gap: 10px; margin: 12px 0 16px; }
.filters .row{ display:flex; gap:10px; flex-wrap: wrap; }

/* Controls */
.input, .select, .btn{
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 12px;
  outline: none;
}
.input::placeholder{ color: var(--muted); }
.input:focus, .select:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(110,168,254,.15); }
.btn{
  cursor: pointer;
  transition: transform .05s ease, background .2s ease, border-color .2s ease;
}
.btn:hover{ border-color: var(--accent); background: var(--card-2); }
.btn:active{ transform: translateY(1px); }
.btn-icon{ padding: 8px 10px; border-radius: 8px; }

/* Chips */
.chips{ gap:8px; }
.chip{
  background: transparent;
  color: var(--text);
  border: 1px dashed var(--border);
  padding: 6px 10px;
  border-radius: 999px;
  cursor: pointer;
}
.chip.is-active{
  border-style: solid;
  border-color: var(--accent);
  background: rgba(110,168,254,.1);
}

/* Table Card */
.table-card{
  background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 50%) , var(--card);
  border:1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
}

/* Contenedor scroll (thead sticky) */
.table-scroll{ overflow: auto; max-height: calc(100vh - 280px); }

/* Tabla */
.grid{
  width:100%;
  border-collapse: collapse;
  table-layout: fixed;
}
.grid thead th{
  text-align:left;
  font-weight:600;
  padding:12px;
  font-size:12px;
  color: var(--muted);
  background: var(--card-2);
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0;
  z-index: 5;
}
.grid tbody td{
  padding:12px;
  border-top: 1px solid rgba(38,49,86,.5);
  vertical-align: top;
  white-space: nowrap; text-overflow: ellipsis; overflow: hidden;
}
.grid tbody tr{ transition: background .15s ease; cursor: pointer; }
.grid tbody tr:hover{ background: rgba(110,168,254,.06); }

/* Empty state */
.empty{ text-align:center; padding: 28px 16px; color: var(--muted); }
.hidden{ display:none !important; }

/* Badges */
.badge{
  display:inline-block; padding: 3px 8px; border-radius: 999px;
  font-size: 11px; border:1px solid var(--border); background: var(--card-2); color: var(--text);
}
.status-open{ background: rgba(32,201,151,.12); color:#9ff3da; border-color: rgba(32,201,151,.35); }
.status-closed{ background: rgba(239,68,68,.12); color:#fecaca; border-color: rgba(239,68,68,.35); }

.area-it{ background: rgba(96,165,250,.14); color:#cfe5ff; border-color: rgba(96,165,250,.35); }
.area-man{ background: rgba(245,158,11,.16); color:#ffe7bd; border-color: rgba(245,158,11,.35); }
.area-ama{ background: rgba(167,139,250,.16); color:#e7dbff; border-color: rgba(167,139,250,.35); }
.area-rs{  background: rgba(20,184,166,.16); color:#b8fff1; border-color: rgba(20,184,166,.35); }
.area-seg{ background: rgba(148,163,184,.16); color:#e2e8f0; border-color: rgba(148,163,184,.35); }

.muted{ color: var(--muted); }

/* Pager */
.pager{
  display:flex; align-items:center; justify-content:center; gap:12px;
  padding: 12px; border-top: 1px solid var(--border); background: var(--card-2);
}

/* Modal */
.overlay{
  position: fixed; inset:0; background: rgba(9,12,25,.6);
  display:flex; align-items:flex-start; justify-content:center;
  padding: 32px 16px; backdrop-filter: blur(4px); z-index: 20;
}
.modal{
  position: relative; width: min(1200px, 96vw);
  background: var(--card); border: 1px solid var(--border); border-radius: 16px;
  box-shadow: 0 20px 50px rgba(0,0,0,.4);
  padding: 18px 18px 24px; max-height: calc(100vh - 64px); overflow: auto;
}
.modal-head{
  display:flex; align-items:center; justify-content:space-between; gap:16px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 12px; position: relative; padding-right: 56px; /* hueco para la X */
}
.modal-head h3{
  margin:6px 0 0; font-size: 18px; max-width: 60%;
  overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
}
.meta{ display:flex; align-items:center; gap:8px; flex-wrap: wrap; }
.close{
  position:absolute; top:10px; right:10px; width: 34px; height: 34px;
  display:grid; place-items:center; border-radius: 8px; background: transparent;
  z-index: 2; cursor: pointer;
}
.close:hover{ background: rgba(255,255,255,.04); box-shadow: inset 0 0 0 1px var(--border); }

.modal-body{ display:grid; gap:12px; grid-template-columns: 1fr 1fr; padding-top: 14px; }
@media (max-width: 820px){ .modal-body{ grid-template-columns: 1fr; } }

/* Cards */
.card{ background: var(--card-2); border:1px solid var(--border); border-radius: 12px; padding: 12px; }
.card h4{ margin: 0 0 8px; font-size: 13px; color: var(--muted); letter-spacing:.3px; font-weight:600; }
.card.desc{ grid-column: 1 / -1; }

/* Key-Value grid */
.kv{ display:grid; grid-template-columns: 120px 1fr; gap:8px 12px; }
.kv .label{ color: var(--muted); }

/* Gallery (detalle) */
.gallery{
  display:grid; grid-template-columns: repeat(auto-fill, minmax(120px,1fr));
  gap: 8px;
}
.gallery .thumb{
  display:block; border-radius: 10px; overflow: hidden;
  border:1px solid var(--border); background: #0b0f1e;
}
.gallery .thumb img{
  display:block; width:100%; height:110px; object-fit: cover;
  transition: transform .2s ease, opacity .2s ease;
}
.gallery .thumb:hover img{ transform: scale(1.03); opacity:.95; }
.gallery .file{
  display:inline-block; padding:8px 10px; border-radius: 10px; background: var(--card-2);
  border:1px dashed var(--border); color: var(--text); text-decoration:none;
}

/* Timeline */
.timeline{ margin-top:16px; }
.timeline h4{ margin: 0 0 8px; font-size: 13px; color: var(--muted); }
.events{ list-style:none; margin:0; padding:0; display:grid; gap:10px; }
.event{ background: var(--card-2); border:1px solid var(--border); border-radius: 12px; padding:10px; }
.event .when{ color: var(--muted); font-size: 12px; margin-bottom:6px; }
.event .etype{ color: var(--accent); }

/* Galería compacta para timeline */
.gallery.gallery--sm img{ height: 80px; }

/* Links */
a{ color: var(--accent); }
a:hover{ color: #9cc3ff; }

/* Placeholder de evidencias */
.empty-evidence{
  display:flex; align-items:center; justify-content:center;
  min-height:120px; border:1px dashed var(--border); border-radius:10px;
  color: var(--muted); background: rgba(255,255,255,.02);
}
.empty-evidence .icon{ font-size:22px; margin-right:8px; opacity:.8; }

/* ─────────────────────────────────────────── */
/*   MODAL HEADER: ESTATUS (dropdown)          */
/* ─────────────────────────────────────────── */
.status-wrap{ position: relative; }

/* Trigger (acepta .status-pill o .status-badge) */
.status-pill,
.status-badge{
  display:inline-flex; align-items:center; gap:8px; padding:6px 10px;
  border-radius:999px; border:1px solid var(--border); background:var(--card-2);
  font-weight:600; cursor:pointer; user-select:none;
}
.status-pill .dot, .status-badge .dot{
  width:10px; height:10px; border-radius:999px; box-shadow:0 0 0 2px rgba(0,0,0,.25) inset;
}

/* Dropdown: cae hacia abajo y los botones van en HORIZONTAL */

.status-wrap.is-open .status-picker{ display: flex; animation: st-drop .12s ease-out; }
@keyframes st-drop{ from{opacity:0; transform:translateY(-6px) scale(.98);} to{opacity:1; transform:translateY(0) scale(1);} }

/* Botones redondeados, todos del mismo tamaño */
.status-option{
  min-width: 150px; height: 42px;
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  border-radius:999px; font-weight:700; letter-spacing:.2px;
  border:1px solid transparent; cursor:pointer; user-select:none;
  transition: filter .15s ease, transform .05s ease, box-shadow .15s ease;
  color:#0b0f1e;
}
.status-option:hover{ filter: brightness(1.06); transform: translateY(-1px); }
.status-option:active{ transform: translateY(0); }
.status-option .dot{ width:10px; height:10px; border-radius:999px; background: currentColor; opacity:.65; }

/* Colores por estado */
.status-option.opt-open{        /* Abierta (amarillo) */
  background:#f59f00; color:#0b0f1e; box-shadow:0 6px 16px rgba(245,159,0,.28);
}
.status-option.opt-progress{    /* En proceso (turquesa) */
  background:#952caa; color:#31072d; box-shadow:0 6px 16px rgba(20,184,166,.28);
}
.status-option.opt-canceled{    /* Cancelada (rojo) */
  background:#ef4444; color:#fff; box-shadow:0 6px 16px rgba(239,68,68,.28);
}
.status-option.opt-done{        /* Terminada (verde) */
  background:#20c997; color:#05241b; box-shadow:0 6px 16px rgba(32,201,151,.28);
}

/* ─────────────────────────────────────────── */
/*   Notas / Chat                              */
/* ─────────────────────────────────────────── */
.chat{ display:flex; flex-direction:column; gap:10px; }

.chat-list{
  display:flex; flex-direction:column; gap:8px;
  max-height:260px; overflow:auto; padding-right:4px;
}

.chat-input{ display:flex; align-items:center; gap:8px; margin-top: 2px; }
.chat-text{
  flex:1; background:#fff; color:#0f172a;
  border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none;
}
.chat-text::placeholder{ color:#6b7280; }
.chat-send{
  width:42px; height:42px; display:grid; place-items:center; border-radius:999px;
  border:1px solid var(--accent); background: var(--accent); color:#fff; cursor:pointer;
  transition: filter .15s ease, transform .05s ease;
}
.chat-send:hover{ filter: brightness(1.08); }
.chat-send:active{ transform: translateY(1px); }
.chat-send svg{ width:18px; height:18px; fill: currentColor; }

.bubble{
  max-width: 80%; padding:8px 10px; border-radius:12px;
  border:1px solid var(--border); background: var(--card-2);
}
.bubble .meta{ font-size:11px; color:var(--muted); margin-top:4px; }
.bubble--me{ align-self:flex-end; background: rgba(110,168,254,.18); border-color: rgba(110,168,254,.35); }
.bubble--sys{ background: rgba(255,255,255,.04); }

/* Notas con alto fijo y scroll interno */
.card--notes{ display:flex; flex-direction:column; height: clamp(300px, 38vh, 420px); }
.card--notes .chat-list{ flex: 1; min-height: 0; overflow: auto; padding-right: 6px; }
.card--notes .chat-input{ margin-top: 8px; }


/* ── Menú de estatus flotante (NO queda contenido por el header) ── */
.status-picker{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  box-shadow: 0 16px 40px rgba(0,0,0,.45);
  padding: 10px;
  display: flex;                 /* vertical */
  flex-direction: column;
  gap: 10px;
  width: 260px;
  max-height: 60vh;              /* si es largo, scrollea */
  overflow-y: auto;
  transform-origin: top right;
  animation: st-drop .12s ease-out;
}

.status-picker.is-floating{
  position: fixed;               /* << clave: saca el menú del contenedor */
  z-index: 9999;                 /* por encima del modal */
}

@keyframes st-drop {
  from { opacity: 0; transform: translateY(-6px) scale(.98); }
  to   { opacity: 1; transform: translateY(0)    scale(1); }
}

/* Botones llenos, redondeados e iguales */
.status-option{
  width: 100%;
  height: 44px;
  border-radius: 999px;
  font-weight: 700;
  border: 1px solid transparent;
  display:flex; align-items:center; justify-content:center; gap:8px;
  cursor:pointer;
  transition: filter .15s ease, transform .05s ease;
}
.status-option:hover{ filter: brightness(1.05); }
.status-option:active{ transform: translateY(1px); }

.status-option.opt-open{     background:#f59f00; color:#0b0f1e; box-shadow:0 6px 16px rgba(245,159,0,.28); }
.status-option.opt-progress{ background:#14b8a6; color:#07211e; box-shadow:0 6px 16px rgba(20,184,166,.28); }
.status-option.opt-canceled{ background:#ef4444; color:#fff;     box-shadow:0 6px 16px rgba(239,68,68,.28); }
.status-option.opt-done{     background:#20c997; color:#05241b;  box-shadow:0 6px 16px rgba(32,201,151,.28); }

/* ====== STATUS PICKER – tamaño + efecto translúcido ====== */

/* píldora (botón principal) un poco más compacta */
.status-pill{
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 999px;
}

/* colores translúcidos en la PÍLDORA (mismo esquema que te gustó) */
.status-pill.status-open{
  background: rgba(245,159,0,.16);
  color: #ffe7b7;
  border-color: rgba(245,159,0,.38);
}
.status-pill.status-progress{
  background: rgba(20,184,166,.16);
  color: #b8fff1;
  border-color: rgba(20,184,166,.38);
}
.status-pill.status-canceled{
  background: rgba(239,68,68,.16);
  color: #fecaca;
  border-color: rgba(239,68,68,.38);
}
.status-pill.status-done{
  background: rgba(32,201,151,.16);
  color: #9ff3da;
  border-color: rgba(32,201,151,.38);
}

/* contenedor flotante más angosto */
.status-picker{
  position: fixed; /* importante para salir por encima de las cards */
  width: 210px;
  padding: 8px;
  border-radius: 14px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 18px 40px rgba(0,0,0,.5);
  display: grid;
  gap: 8px;
  z-index: 9999;
}

/* OPCIONES más pequeñas */
.status-option{
  height: 36px;                 /* antes 44px */
  font-size: 12.5px;
  border-radius: 10px;
  width: 100%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  cursor: pointer;
  border: 1px solid transparent;
  transition: filter .15s ease, transform .05s ease, box-shadow .15s ease, background-color .15s ease;
}
.status-option:hover{ filter: brightness(1.06); }
.status-option:active{ transform: translateY(1px); }

/* Colores translúcidos en el MENÚ */
.status-option.opt-open{
  background: rgba(245,159,0,.22);
  border-color: rgba(245,159,0,.38);
  color:#fff;
}
.status-option.opt-progress{
  background: rgba(165, 20, 184, 0.22);
  border-color: rgba(184, 20, 184, 0.38);
  color:#eafffb;
}
.status-option.opt-canceled{
  background: rgba(239,68,68,.22);
  border-color: rgba(239,68,68,.38);
  color:#fff1f1;
}
.status-option.opt-done{
  background: rgba(32,201,151,.22);
  border-color: rgba(32,201,151,.38);
  color:#eafff6;
}

/* resalte de la opción que ya está activa */
.status-option.is-current{
  box-shadow: 0 0 0 2px rgba(255,255,255,.15) inset, 0 6px 14px rgba(0,0,0,.25);
  filter: brightness(1.03);
}
/* ====== ACTIVIDAD CON SCROLL INTERNO ====== */
/* El contenedor es una card con alto fijo */
.card--timeline{
  /* ocupa todo el ancho disponible del modal */
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  /* alto: se adapta pero no crece infinito */
  height: clamp(280px, 42vh, 520px);
  overflow: hidden;            /* oculta el desborde del contenedor */
}

/* Título igual que otros cards */
.card--timeline > h4{
  margin: 0 0 8px;
}

/* La lista toma el espacio restante y scrollea por dentro */
.card--timeline .events{
  flex: 1;
  min-height: 0;               /* imprescindible para que flex permita overflow */
  overflow: auto;              /* ← scroll vertical interno */
  padding-right: 6px;          /* respiro para la barra de scroll */
  display: grid;
  gap: 10px;
  list-style: none;
  margin: 0;
}

/* Evento compacto y limpio */
.card--timeline .event{
  background: var(--card-2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
}

/* Cabecera del evento (fecha + tipo) */
.card--timeline .event .when{
  color: var(--muted);
  font-size: 12px;
  margin-bottom: 6px;
}

/* Resalta el tipo de evento */
.card--timeline .event .etype{
  color: var(--accent);
}

/* Galería compacta dentro de actividad (si hay adjuntos) */
.card--timeline .gallery.gallery--sm img{
  height: 80px;
}

/* ── Estados (override de colores translúcidos) ───────────────── */
.badge.status-open{
  /* ABIERTA = amarillo */
  background: rgba(245,159,0,.14) !important;
  color: #ffdd9a !important;
  border-color: rgba(245,159,0,.38) !important;
}
.badge.status-progress{
  /* EN PROCESO = azul/turquesa */
  background: rgba(100, 16, 96, 0.14) !important;
  color: #f3aae1 !important;
  border-color: rgba(184, 20, 170, 0.38) !important;
}
.badge.status-canceled{
  /* CANCELADA = rojo */
  background: rgba(239,68,68,.14) !important;
  color: #fecaca !important;
  border-color: rgba(239,68,68,.38) !important;
}
.badge.status-done{
  /* TERMINADA = verde */
  background: rgba(32,201,151,.14) !important;
  color: #baf5e5 !important;
  border-color: rgba(32,201,151,.36) !important;
}

/* Compat por si en algún lado quedó el antiguo "closed" */
.badge.status-closed{
  background: rgba(239,68,68,.14) !important;
  color: #fecaca !important;
  border-color: rgba(239,68,68,.38) !important;
}
